<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<div class="types-vehicules-container">
    <!-- Header -->
    <div class="header-section">
        <div class="title-area">
            <h2><i class="pi pi-car"></i> Types de Véhicules</h2>
            <p class="subtitle">Gérez les catégories de véhicules disponibles</p>
        </div>
        <div class="stats-cards">
            <p-card styleClass="stat-card">
                <div class="stat-content">
                    <span class="stat-value">{{ totalTypes() }}</span>
                    <span class="stat-label">Total</span>
                </div>
            </p-card>
            <p-card styleClass="stat-card success">
                <div class="stat-content">
                    <span class="stat-value">{{ typesActifs() }}</span>
                    <span class="stat-label">Actifs</span>
                </div>
            </p-card>
        </div>
    </div>

    <!-- Toolbar -->
    <div class="toolbar">
        <p-iconfield iconPosition="left">
            <p-inputicon styleClass="pi pi-search"></p-inputicon>
            <input pInputText type="text" placeholder="Rechercher..." (input)="onSearch($event)" />
        </p-iconfield>
        <div class="actions">
            <p-button label="Actualiser" icon="pi pi-refresh" severity="secondary" [outlined]="true"
                (onClick)="loadTypes()" [loading]="loading()"></p-button>
            <p-button label="Nouveau Type" icon="pi pi-plus" (onClick)="openNewDialog()"></p-button>
        </div>
    </div>

    <!-- Table -->
    <p-card>
        <p-table [value]="filteredTypes()" [paginator]="true" [rows]="10" [loading]="loading()"
            styleClass="p-datatable-sm p-datatable-striped">
            <ng-template pTemplate="header">
                <tr>
                    <th pSortableColumn="libelle">Libellé <p-sortIcon field="libelle"></p-sortIcon></th>
                    <th>Description</th>
                    <th>Capacité</th>
                    <th style="width: 100px">Statut</th>
                    <th style="width: 150px">Actions</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-type>
                <tr>
                    <td><strong>{{ type.libelle }}</strong></td>
                    <td>{{ type.description || '-' }}</td>
                    <td>{{ formatCapacite(type) }}</td>
                    <td>
                        <p-tag [value]="type.actif ? 'Actif' : 'Inactif'"
                            [severity]="type.actif ? 'success' : 'danger'"></p-tag>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <p-button icon="pi pi-pencil" [rounded]="true" [text]="true" severity="info"
                                pTooltip="Modifier" (onClick)="openEditDialog(type)"></p-button>
                            <p-button [icon]="type.actif ? 'pi pi-eye-slash' : 'pi pi-eye'" [rounded]="true"
                                [text]="true" [severity]="type.actif ? 'warn' : 'success'"
                                [pTooltip]="type.actif ? 'Désactiver' : 'Activer'"
                                (onClick)="toggleActif(type)"></p-button>
                            <p-button icon="pi pi-trash" [rounded]="true" [text]="true" severity="danger"
                                pTooltip="Supprimer" (onClick)="confirmDelete(type)"></p-button>
                        </div>
                    </td>
                </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="5" class="text-center p-4">Aucun type de véhicule trouvé</td>
                </tr>
            </ng-template>
        </p-table>
    </p-card>
</div>

<!-- Dialog -->
<p-dialog [(visible)]="dialogVisible" [header]="isEditMode() ? 'Modifier le type' : 'Nouveau type'" [modal]="true"
    [style]="{ width: '500px' }" (onHide)="closeDialog()">
    <form [formGroup]="typeForm" class="form-content">
        <div class="form-field">
            <label for="libelle">Libellé *</label>
            <input pInputText id="libelle" formControlName="libelle" placeholder="Ex: Bus, Minibus, Taxi-brousse..."
                class="w-full" />
            @if (typeForm.get('libelle')?.invalid && typeForm.get('libelle')?.touched) {
            <small class="p-error">Le libellé est obligatoire (2-50 caractères)</small>
            }
        </div>

        <div class="form-field">
            <label for="description">Description</label>
            <textarea pTextarea id="description" formControlName="description" rows="3" class="w-full"
                placeholder="Description du type de véhicule"></textarea>
        </div>

        <div class="form-row">
            <div class="form-field">
                <label for="capaciteMin">Capacité min</label>
                <p-inputNumber id="capaciteMin" formControlName="capaciteMin" [min]="1" [max]="100" suffix=" places"
                    styleClass="w-full"></p-inputNumber>
            </div>
            <div class="form-field">
                <label for="capaciteMax">Capacité max</label>
                <p-inputNumber id="capaciteMax" formControlName="capaciteMax" [min]="1" [max]="100" suffix=" places"
                    styleClass="w-full"></p-inputNumber>
            </div>
        </div>

        <div class="form-field checkbox-field">
            <p-checkbox formControlName="actif" [binary]="true" inputId="actif"></p-checkbox>
            <label for="actif">Actif</label>
        </div>
    </form>

    <ng-template pTemplate="footer">
        <p-button label="Annuler" icon="pi pi-times" [text]="true" (onClick)="closeDialog()"></p-button>
        <p-button [label]="isEditMode() ? 'Mettre à jour' : 'Créer'" icon="pi pi-check" (onClick)="saveType()"
            [loading]="loading()"></p-button>
    </ng-template>
</p-dialog>